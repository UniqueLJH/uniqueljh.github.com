title: 田螺姑娘算法总结

date: 2015-11-16 10:54:45

tags: 宽搜
---

2015年双十一,简寻的小伙伴们开发一款小游戏 "[BUG大作战](http://m.jianxun.io/event/03)”.在进入彩蛋之后,有一个田螺姑娘解救你的选项,有部分朋友对它的算法实现好奇.由我说说该功能是如何实现的.



田螺姑娘的算法: **宽搜队列**, **剪枝**,**redis**

# 预处理



游戏为一个5x5的棋面,每个小格子存在2种状态:0 或 1.

| 0    | 1    | 2    | 3    | 4    | 
| ---- | ---- | ---- | ---- | ---- | 
| 5    | 6    | 7    | 8    | 9    | 
| 10   | 11   | 12   | 13   | 14   | 
| 15   | 16   | 17   | 18   | 19   | 
| 20   | 21   | 22   | 23   | 24   | 

我们为每个小格子编号,并且设p[i]为第i个格子的状态, pvalue = sum(p[i]* 2^i). 于是我们可以求的pvalue棋面上的总和,并且pvalue的每一个值都能和唯一的一个棋面一一映射.

# 状态转移

该游戏的搜索状态转移策略并不复杂, 就是将点击方块和其上下左右的5个方块取反.就能得到点击之后的状态.我们从pvalue1,听过进制转换很容易的到局面情况,再通过简单的边界判断,就能得到点击之后的pvalue2.

# 宽搜队列

我们从结束状态开始逆向宽搜,这样能保证所有搜索到的棋面都是有解.

先将结束状态 value_end = 0 入队, 从当前状态能有25种新的状态入队.但是我们在入队前必须判断该状态是否已经被遍历过了,如果没有则入队,如果已经遍历则不将该状态入队,这样能防止状态转移出现死循环.

# redis

存储状态转移,每次在宽搜队列中,新的状态被遍历时我们都将以

key:value             队尾状态值: 队首状态值   存入redis

于是在获取解法步骤时我们的复杂度能降低到O(1)

# 剪枝

我们发现棋面是可以旋转,有一些棋面状态经过旋转之后是全等的,于是我们在定义局面pvalue时,每个局面进行3次90度旋转.选取一个最大的pvalue作为该局面的描述 

pvalue = max(pvalue_0, pvalue_90,pvalue180,pvalue270)

# 总结

此次田螺姑娘的算法,我使用python实现5x5的局面约200w状态共费事50分钟遍历完成,算法仅用粗糙的剪枝.相信很多朋友能会做的比我更加简洁,而且又更加优美.





